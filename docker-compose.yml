version: "3.9"

networks:
  mc_network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.20.0.0/16

services:
  auto_starter:
    build: .
    ports:
      - 25565:25565
      - 25566:25566
    environment:
      PORT_IP_MAP: |
        25565: 172.20.0.3
        25566: 172.20.0.4
    networks:
      mc_network:
        ipv4_address: 172.20.0.2
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

  mc:
    image: itzg/minecraft-server
    environment:
      type: "PAPER"
      EULA: "TRUE"
      MOTD: "TEST1"
      #! Dont change SERVER_PORT. Use PORT_IP_MAP in auto_starter instead.
      #! SERVER_PORT default is "25565"
    networks:
      mc_network:
        ipv4_address: 172.20.0.3
  mc2:
    image: itzg/minecraft-server
    environment:
      type: "PAPER"
      EULA: "TRUE"
      MOTD: "TEST2"
      #! Dont change SERVER_PORT. Use PORT_IP_MAP in minecraft_server_auto_starter instead.
      #! SERVER_PORT default is "25565"
    networks:
      mc_network:
        ipv4_address: 172.20.0.4
